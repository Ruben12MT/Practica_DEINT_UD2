<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/branch_components/BranchGraph.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/branch_components/BranchGraph.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect, useRef } from "react";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from "recharts";
import { Grid, Button } from "@mui/material";
import { useThemeStore } from "../../store/useThemeStore";

import html2canvas from "html2canvas";
import { jsPDF } from "jspdf";

/**
 * Componente que muestra una gráfica de barras con los ingresos mensuales de las sucursales.
 * Permite descargar la gráfica en formato PDF.
 * Usa Recharts para la visualización y html2canvas/jspdf para la exportación.
 * 
 * @returns {JSX.Element} Gráfica de ingresos y botón de exportación.
 */
export default function BranchGraph() {
  const [data, setData] = useState([]); // Datos para la gráfica
  const darkMode = useThemeStore((state) => state.darkMode); // Estado del tema
  const chartRef = useRef(null); // Referencia al contenedor de la gráfica

  // Cargar datos de sucursales al montar
  useEffect(() => {
    async function fetchBranches() {
      const respuesta = await fetch(
        window.__APP_CONFIG__.API_URL + "/branches"
      );
      const json = await respuesta.json();
      console.log(json.datos);
      setData(json.datos);
    }

    fetchBranches();
  }, []);

  async function generatePDF() {
    if (!chartRef.current) return;
    try {
      const canvas = await html2canvas(chartRef.current, {
        scale: 2,
        useCORS: true,
        backgroundColor: darkMode ? "#1f1f1f" : "#ffffff",
      });

      const imgData = canvas.toDataURL("image/png");
      const pdf = new jsPDF({ orientation: "landscape", unit: "mm", format: "a4" });
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = pdf.internal.pageSize.getHeight();

      const imgProps = pdf.getImageProperties(imgData);
      let imgWidth = pdfWidth;
      let imgHeight = (imgProps.height * pdfWidth) / imgProps.width;

      if (imgHeight > pdfHeight) {
        const ratio = pdfHeight / imgHeight;
        imgHeight = pdfHeight;
        imgWidth = imgWidth * ratio;
      }

      const marginX = (pdfWidth - imgWidth) / 2;
      const marginY = 10;

      pdf.addImage(imgData, "PNG", marginX, marginY, imgWidth, imgHeight);
      const fecha = new Date().toISOString().split('T')[0];
      pdf.save(`informe_sucursales_${fecha}.pdf`);
    } catch (error) {
      console.error("Error generando PDF:", error);
    }
  }

  return (
    &lt;Grid container spacing={2} justifyContent="center">
      &lt;Grid item xs={12} sx={{ pt: 2 }} display="flex">
        &lt;Button variant="contained" onClick={generatePDF}>Generar (PDF)&lt;/Button>
      &lt;/Grid>

      &lt;Grid item xs={12} ref={chartRef} sx={{ width: "100%", height: "500px", background: darkMode ? "#1f1f1f" : "#ffffff" }}>
        &lt;ResponsiveContainer width="100%" height="100%">
          &lt;BarChart data={data} margin={{ top: 50, right: 30, left: 20, bottom: 5 }}>
            &lt;text
              x="50%"
              y="25"
              fill={darkMode ? "#ffffff" : "#000000"}
              textAnchor="middle"
              dominantBaseline="central"
              style={{ fontSize: "20px", fontWeight: "bold" }}
            >
              Análisis de Ingresos Mensuales por Sucursal
            &lt;/text>
            &lt;CartesianGrid />
            &lt;XAxis dataKey="name" interval={0} angle={-45} textAnchor="end" height={100} />
            &lt;YAxis />
            &lt;Tooltip contentStyle={{ color: "#000000" }} />
            &lt;Legend verticalAlign="bottom" height={36} />
            &lt;Bar name="Ingresos (€)" dataKey="monthly_income" fill="#31b3cd" />
          &lt;/BarChart>
        &lt;/ResponsiveContainer>
      &lt;/Grid>
    &lt;/Grid>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BasicMenu">BasicMenu</a></li><li><a href="global.html#FormBank">FormBank</a></li><li><a href="global.html#FormBranch">FormBranch</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#InformeSucursales">InformeSucursales</a></li><li><a href="global.html#ResponsiveAppBar">ResponsiveAppBar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Feb 05 2026 18:03:36 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

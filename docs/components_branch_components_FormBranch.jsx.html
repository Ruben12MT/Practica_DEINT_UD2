<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/branch_components/FormBranch.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/branch_components/FormBranch.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from "react";
import {
  Container,
  Typography,
  Box,
  TextField,
  FormControlLabel,
  Switch,
  Button,
  Grid,
} from "@mui/material";
import CleaningServicesIcon from "@mui/icons-material/CleaningServices";
import AccountBalanceIcon from "@mui/icons-material/AccountBalance";
import EventDialog from "../EventDialog";
import useEventDialog from "../../hooks/useEventDialog";
import BanksSelect from "../bank_components/BanksSelect";
import { useNavigate } from "react-router";

/**
 * Formulario para crear o editar una sucursal.
 * Maneja la validación de campos como nombre, cajeros, ingresos, fecha y banco asociado.
 * 
 * @param {Object} props - Propiedades del componente.
 * @param {Object} [props.branchToEdit=null] - Objeto sucursal si se está editando.
 * @returns {JSX.Element} Formulario de gestión de sucursales.
 */
function FormBranch({ branchToEdit = null }) {
  // Hook de diálogos
  const {
    openDialog,
    dialogTitle,
    dialogDescription,
    setOpenDialog,
    llamarDialog,
  } = useEventDialog();

  // Estados del formulario
  const [branchName, setBranchName] = useState("");
  const [nTellers, setNTellers] = useState("");
  const [monthlyIncome, setMonthlyIncome] = useState("");
  const [openingDate, setOpeningDate] = useState("");
  const [branchOpenStatus, setBranchOpenStatus] = useState(true);
  const [idBank, setIdBank] = useState("");

  const navigate = useNavigate();

  // Estado de validación
  const [validateInputsObj, setValidateInputsObj] = useState({
    name: true,
    tellers: true,
    income: true,
    date: true,
    bankId: true,
  });
  const [isLoading, setIsLoading] = useState(false);

  // Cargar datos si es edición
  useEffect(() => {
    if (branchToEdit) {
      setBranchName(branchToEdit.name);
      setNTellers(branchToEdit.n_tellers);
      setMonthlyIncome(branchToEdit.monthly_income);
      setOpeningDate(branchToEdit.opening_date);
      setBranchOpenStatus(branchToEdit.open);
      setIdBank(branchToEdit.id_bank);
    }
  }, [branchToEdit]);

  // Manejar cierre de diálogo
  useEffect(() => {
    if (!openDialog &amp;&amp; (dialogTitle !== "" || dialogTitle !== "")) {
      if (branchToEdit) {
        navigate("/");
      } else {
        cleanInputs();
      }
    }
  }, [openDialog, dialogTitle, branchToEdit, navigate]);

  /**
   * Limpia el formulario.
   */
  function cleanInputs() {
    setBranchName("");
    setNTellers("");
    setMonthlyIncome("");
    setOpeningDate("");
    setBranchOpenStatus(true);
    setIdBank("");
  }

  /**
   * Valida los campos del formulario.
   * @returns {boolean} true si es válido.
   */
  function validateInputs() {
    const bolName = branchName.trim() !== "";
    const bolTellers = /^\d+$/.test(nTellers);
    const bolIncome = /^\d+(\.\d{0,2})?$/.test(monthlyIncome);
    const bolDate = openingDate.trim() !== "";
    const bolBankId = idBank !== "";

    setValidateInputsObj({
      name: bolName,
      tellers: bolTellers,
      income: bolIncome,
      date: bolDate,
      bankId: bolBankId,
    });

    return bolName &amp;&amp; bolTellers &amp;&amp; bolIncome &amp;&amp; bolDate &amp;&amp; bolBankId;
  }

  /**
   * Envía los datos a la API para crear o actualizar la sucursal.
   */
  async function accionSucursal() {

    setIsLoading(true);
    const nuevaSucursal = {
      name: branchName,
      n_tellers: parseInt(nTellers),
      monthly_income: parseFloat(monthlyIncome),
      opening_date: openingDate,
      open: branchOpenStatus,
      id_bank: parseInt(idBank),
    };

    try {
      const url = branchToEdit
        ? window.__APP_CONFIG__.API_URL + `/branches/${branchToEdit.id}`
        : window.__APP_CONFIG__.API_URL + "/branches";

      const method = branchToEdit ? "PUT" : "POST";

      const respuesta = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(nuevaSucursal),
      });

      if (!respuesta.ok)
        throw new Error(
          branchToEdit
            ? "Error al modificar la sucursal"
            : "Error al insertar la sucursal",
        );

      const data = await respuesta.json();
      console.log(
        branchToEdit
          ? "Sucursal actualizada correctamente:"
          : "Sucursal insertada correctamente:",
        data,
      );

      if (respuesta.ok)
        llamarDialog(
          branchToEdit ? "Sucursal actualizada" : "Sucursal insertada",
          data.mensaje,
        );
      cleanInputs();
    } catch (error) {
      console.error("Error en accionSucursal:", error);
      llamarDialog("Error en accionSucursal", error.message);
    } finally {
      setIsLoading(false);

    }
  }

  return (
    &lt;Container sx={{ mt: 4, mb: 10 }}>
      &lt;Typography sx={{ fontWeight: "bold", mb: 1 }} variant="h5">
        {branchToEdit ? "Editar sucursal" : "Alta de sucursal"}
      &lt;/Typography>

      &lt;Grid container spacing={3}>
        &lt;Grid size={{ xs: 12, lg: 6 }}>
          &lt;TextField
            error={!validateInputsObj.name}
            label="Nombre de la sucursal"
            variant="filled"
            value={branchName}
            onChange={(e) => setBranchName(e.target.value)}
            required
            fullWidth
          />
        &lt;/Grid>

        &lt;Grid size={{ xs: 12, lg: 6 }}>
          &lt;TextField
            error={!validateInputsObj.tellers}
            label="Número de cajeros"
            variant="filled"
            type="number"
            fullWidth
            value={nTellers}
            onChange={(e) => setNTellers(e.target.value)}
            required
          />
        &lt;/Grid>

        &lt;Grid size={{ xs: 12, lg: 6 }}>
          &lt;TextField
            error={!validateInputsObj.income}
            label="Ingresos mensuales (€)"
            variant="filled"
            type="number"
            fullWidth
            value={monthlyIncome}
            onChange={(e) => setMonthlyIncome(e.target.value)}
            required
          />
        &lt;/Grid>

        &lt;Grid size={{ xs: 12, lg: 6 }}>
          &lt;TextField
            error={!validateInputsObj.date}
            label="Fecha de apertura"
            variant="filled"
            type="date"
            fullWidth
            slotProps={{ inputLabel: { shrink: true } }}
            value={openingDate}
            onChange={(e) => setOpeningDate(e.target.value)}
            required
          />
        &lt;/Grid>

        &lt;Grid size={{ xs: 12, lg: 6 }}>
          &lt;BanksSelect
            value={idBank}
            onChange={(e) => setIdBank(e.target.value)}
            error={!validateInputsObj.bankId}
          />
        &lt;/Grid>

        &lt;Grid
          size={{ xs: 12, lg: 6 }}
          container
          spacing={2}
          justifyContent={"center"}
          alignItems={"center"}
          direction={{ xs: "column", lg: "row" }}
          padding={{ xs: 2, lg: 0 }}
          sx={{
            borderRadius: 2,
            border: "1px solid",
            borderColor: "divider",
          }}
        >
          &lt;Typography>¿La sucursal está abierta?&lt;/Typography>
          &lt;FormControlLabel
            control={
              &lt;Switch
                checked={branchOpenStatus}
                onChange={(e) => setBranchOpenStatus(e.target.checked)}
              />
            }
            label={branchOpenStatus ? "Abierta" : "Cerrada"}
          />
        &lt;/Grid>

        &lt;Grid size={{ xs: 12 }}>
          &lt;Box sx={{ display: "flex", justifyContent: "space-between", mt: 2 }}>
            &lt;Button
              variant="contained"
              startIcon={&lt;CleaningServicesIcon />}
              sx={{
                color: "primary",
                backgroundColor: "orange",
              }}
              onClick={cleanInputs}
            >
              LIMPIAR CAMPOS
            &lt;/Button>
            &lt;Button
              variant="contained"
              endIcon={&lt;AccountBalanceIcon />}
              disabled={isLoading}
              sx={{
                color: "primary",
                backgroundColor: "green",
              }}
              onClick={async () => {
                if (validateInputs()) await accionSucursal();
                else console.error("Los datos no son válidos");
              }}
            >
              {branchToEdit ? "APLICAR DATOS" : "DAR DE ALTA LA SUCURSAL"}
            &lt;/Button>
          &lt;/Box>
        &lt;/Grid>
      &lt;/Grid>

      &lt;EventDialog
        title={dialogTitle}
        descriptionEvent={dialogDescription}
        openDialog={openDialog}
        setOpenDialog={setOpenDialog}
      />
    &lt;/Container>
  );
}

export default FormBranch;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BasicMenu">BasicMenu</a></li><li><a href="global.html#FormBank">FormBank</a></li><li><a href="global.html#FormBranch">FormBranch</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#InformeSucursales">InformeSucursales</a></li><li><a href="global.html#ResponsiveAppBar">ResponsiveAppBar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Feb 09 2026 11:21:26 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
